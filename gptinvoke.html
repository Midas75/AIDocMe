<html lang="zh-cn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <button id="send">send</button>

    <script type="module">
        async function chat() {
            const response = await fetch(
                "https://ark.cn-beijing.volces.com/api/v3/chat/completions", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": "Bearer 76a878dc-4905-44c3-858c-8ef33006250f"
                },
                body: JSON.stringify(
                    {
                        model: "ep-20250522175540-clbcq",
                        messages: [
                            {
                                role: "user",
                                content: [
                                    {
                                        type: "text",
                                        text: "你好"
                                    }
                                ]
                            }
                        ],
                        stream: true
                    }
                )
            })
            const reader = response.body.getReader();
            const decoder = new TextDecoder('utf-8');

            let result = '';

            while (true) {
                const { done, value } = await reader.read();
                if (done) break;

                const chunk = decoder.decode(value);
                const lines = chunk.split('\n').filter(line => line.trim().startsWith('data:'));

                for (const line of lines) {
                    const message = line.replace(/^data:\s*/, '');
                    if (message === '[DONE]') {
                        console.log('响应结束');
                        break;
                    }

                    try {
                        const parsed = JSON.parse(message);
                        const content = parsed.choices[0]?.delta?.content;
                        if (content) {
                            result += content;
                            console.log(content);
                        }
                    } catch (e) {
                        console.error('解析失败：', e);
                    }
                }
            }

            console.log('最终结果：', result);
        }
        document.getElementById("send").onclick = chat

    </script>
</body>

</html>